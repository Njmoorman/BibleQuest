workflows:
  ios-release:
    name: iOS Release Build
    environment:
      groups:
        - appstore_credentials # references your Codemagic saved credentials
      vars:
        XCODE_WORKSPACE: "BibleQuestForKids.sln"
        XCODE_SCHEME: "BibleQuestForKids"
        APP_IDENTIFIER: "app.biblequest"
        TEAM_ID: "2989BXM365"
        BUNDLE_ID: "app.biblequest"
      xcode: latest
      cocoapods: default
    integrations:
      app_store_connect:
        name: appstore_credentials
        type: appstoreconnect
        group: appstore_credentials
        source: environment
        filePath: ""
    scripts:
      - name: Install .NET and MAUI workloads
        script: |
          export PATH="$PATH:$HOME/.dotnet/tools"
          dotnet workload install maui-ios
          dotnet workload list

      - name: Restore and build MAUI iOS app
        script: |
          dotnet restore BibleQuestForKids/BibleQuestForKids.csproj
          dotnet publish BibleQuestForKids/BibleQuestForKids.csproj \
            -c Release \
            -f net8.0-ios \
            -p:ArchiveOnBuild=true \
            -p:RuntimeIdentifier=ios-arm64 \
            -p:CodesignKey="Apple Distribution: Jordy Moorman (2989BXM365)" \
            -p:CodesignTeamId=2989BXM365 \
            -p:ApplicationDisplayVersion=1.1.0 \
            -p:ApplicationVersion=1

      - name: Locate IPA
        script: |
          find BibleQuestForKids/bin/Release/net8.0-ios/ios-arm64/publish -name "*.ipa" -print

    artifacts:
      - BibleQuestForKids/bin/Release/net8.0-ios/ios-arm64/publish/*.ipa

    publishing:
      app_store_connect:
        auth: integration
        submit_to_testflight: true